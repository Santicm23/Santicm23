---
import { getLangFromUrl, useTranslations } from "@/utils/i18n"
import SendIcon from "../icons/SendIcon"
import Chip from "../text/Chip.astro"

const lang = getLangFromUrl(Astro.url)

const t = useTranslations(lang)
---

<article
	class="fade-in-scroll z-10 rounded-xl border border-white bg-white/20 p-4 shadow-xl outline outline-1 outline-gray-300 dark:border-white/10 dark:bg-gray-700/30 dark:shadow-none dark:outline-gray-700/20"
>
	<form action="" class="flex flex-col gap-4">
		<h2 class="font-bold">{t("contact")}</h2>
		<input
			name="email"
			type="email"
			placeholder={t("contact.email")}
			class="rounded-xl border border-white bg-white/50 px-4 py-2 outline outline-1 outline-gray-300 dark:border-white/10 dark:bg-gray-700/50 dark:outline-gray-700/20"
		/>
		<input
			name="subject"
			type="text"
			placeholder={t("contact.subject")}
			class="rounded-xl border border-white bg-white/50 px-4 py-2 outline outline-1 outline-gray-300 dark:border-white/10 dark:bg-gray-700/50 dark:outline-gray-700/20"
		/>
		<textarea
			name="message"
			placeholder={t("contact.message")}
			class="max-h-[258px] min-h-[66px] resize-none rounded-xl border border-white bg-white/50 px-4 py-2 outline outline-1 outline-gray-300 [field-sizing:content] dark:border-white/10 dark:bg-gray-700/50 dark:outline-gray-700/20"
		></textarea>
		<button
			id="submitContact"
			class="group/button mx-auto rounded-full p-px focus:outline-indigo-400 dark:focus:outline-violet-400 disabled:cursor-default"
		>
			<Chip class="flex gap-2 px-2 py-1">
				<SendIcon
					className="size-4 transition-colors duration-200 group-disabled/button:text-gray-500 group-hover/chip:text-indigo-400 dark:group-hover/chip:text-violet-400"
				/>
				<span
					class="transition-colors duration-200 group-disabled/button:text-gray-500 group-hover/chip:text-indigo-400 dark:group-hover/chip:text-violet-400"
				>
					{t("contact.send")}
				</span>
			</Chip>
		</button>
	</form>

	<script>
		import { API_URL } from "@/config/environment/secrets"
		import axios from "axios"

		const button = document.querySelector("button#submitContact") as HTMLButtonElement
		const handleSubmit = async (event: SubmitEvent) => {
			event.preventDefault()

			const formData = new FormData(event.target as HTMLFormElement)
			const email = formData.get("email")
			const subject = formData.get("subject")
			const message = formData.get("message")

			if (!email || !subject || !message) {
				alert("Please fill all the fields")
				return
			}
			try {
				button!.disabled = true
				await axios.post(`${API_URL}/email/send`, {
					email,
					subject,
					message,
				})
				formData.forEach((_, key) => {
					const input = document.querySelector(`[name="${key}"]`) as HTMLInputElement
					input.value = ""
				})
				alert("Email sent")
			} catch (error) {
				alert("Error sending email")
			}
		}

		const form = document.querySelector("form")
		form?.addEventListener("submit", handleSubmit)
	</script>
</article>
